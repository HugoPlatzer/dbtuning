\documentclass[11pt]{scrartcl}

\usepackage[top=2cm]{geometry}
%\pagestyle{empty}

\title{
  \textbf{\large Database Tuning -- Assignment 4}\\
  Index Tuning
}

\author{
 Group Name A3\\
 \large Platzer Hugo, 1421579 \\
 \large Strohmeier Mario, 1422959 \\
}

\begin{document}

\maketitle

\noindent
{\it Notes:}
\begin{itemize}\itemsep=0pt
\item Do not forget to run {\tt ANALYZE tablename} after creating or
  changing a table.
\item Use {\tt EXPLAIN ANALYZE} for the query plans that you display in the report.
\end{itemize}


\section{Experimental Setup}

How do send the queries to the database? How do you measure the
execution time for a sequence of queries?\\
We send the Queries from a Java program. The time was measured with System.nanoTime() from Java.

\section{Clustered B$^+$-Tree Index}

\paragraph{Point Query}

Repeat the following query multiple times with different conditions for {\tt pubID}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE pubID = ...
\end{verbatim}
}

\noindent
Which conditions did you use?\\
We created a file of 20000 pubIDs, which we got from the actual data.\\
This file was then read into Java and executed as Prepared Statements.

\smallskip\noindent
Show the runtime results and compute the throughput.
Runtime: 64.1s => 0.0032s/q\\
Throughput: 312q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
 Index Scan using publ_idx on publ  (cost=0.43..8.45 rows=1 width=112)
 (actual time=0.026..0.026 rows=0 loops=1)
   Index Cond: ((pubid)::text = ' books/acm/Kim95'::text)
 Planning time: 0.153 ms
 Execution time: 0.050 ms
\end{verbatim}
}

\paragraph{Multipoint Query -- Low Selectivity}

Repeat the following query multiple times with different conditions for {\tt booktitle}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE booktitle = ...
\end{verbatim}
}

\noindent
Which conditions did you use?
We created a file of 4841 booktitles, which we got from the actual data. These are all distinct booktitles.\\
This file was then read into Java and executed as Prepared Statements.

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: 20.8s => 0.0043s/q\\
Throughput: 233q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
 Index Scan using publ_idx on publ  (cost=0.43..569.73 rows=179 width=112)
 (actual time=0.040..0.089 rows=97 loops=1)
   Index Cond: ((booktitle)::text = 'Z User Workshop'::text)
 Planning time: 0.106 ms
 Execution time: 0.150 ms
\end{verbatim}
}


\paragraph{Multipoint Query -- High Selectivity}

Repeat the following query multiple times with different conditions for {\tt year}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE year = ...
\end{verbatim}
}

\noindent
Which conditions did you use?

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: \\
Throughput: 

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
query plan
\end{verbatim}
}

\section{Non-Clustered B$^+$-Tree Index}

\noindent \emph{Note:} Make sure the data is not physically ordered by
the indexed attributes due to the clustering index that you created
before.

\paragraph{Point Query}

Repeat the following query multiple times with different conditions for {\tt pubID}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE pubID = ...
\end{verbatim}
}

\noindent
Which conditions did you use?\\
We created a file of 20000 pubIDs, which we got from the actual data.\\
This file was then read into Java and executed as Prepared Statements.\\
Further queries used the same setup, using booktitles and years.

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: 63.9s => 0.0032s/q\\
Throughput: 313q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
 Index Scan using publ_idx on publ  (cost=0.43..8.45 rows=1 width=112)
 (actual time=0.026..0.026 rows=0 loops=1)
   Index Cond: ((pubid)::text = ' books/acm/Kim95'::text)
 Planning time: 0.154 ms
 Execution time: 0.049 ms
\end{verbatim}
}


\paragraph{Multipoint Query -- Low Selectivity}

Repeat the following query multiple times with different conditions for {\tt booktitle}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE booktitle = ...
\end{verbatim}
}

\noindent
Which conditions did you use?
We created a file of 4841 booktitles, which we got from the actual data. These are all distinct booktitles.\\
This file was then read into Java and executed as Prepared Statements.

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: 22.1s => 0.0046s/q\\
Throughput: 219q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
 Index Scan using publ_idx on publ  (cost=0.43..569.73 rows=179 width=112) (actual time=0.050..0.119 rows=97 loops=1)
   Index Cond: ((booktitle)::text = 'Z User Workshop'::text)
 Planning time: 0.275 ms
 Execution time: 0.178 ms
\end{verbatim}
}


\paragraph{Multipoint Query -- High Selectivity}

Repeat the following query multiple times with different conditions for {\tt year}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE year = ...
\end{verbatim}
}

\noindent
Which conditions did you use?

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: \\
Throughput: 

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
query plan
\end{verbatim}
}

\section{Non-Clustered Hash Index}

\noindent \emph{Note:} Make sure the data is not physically ordered by
the indexed attributes due to the clustering index that you created
before.

\paragraph{Point Query}

Repeat the following query multiple times with different conditions for {\tt pubID}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE pubID = ...
\end{verbatim}
}

\noindent
Which conditions did you use?\\
We created a file of 20000 pubIDs, which we got from the actual data.\\
This file was then read into Java and executed as Prepared Statements.\\
Further queries used the same setup, using booktitles and years.

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: 65.8s => 0.0033s/q\\
Throughput: 304q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
 Index Scan using publ_idx on publ  (cost=0.00..8.02 rows=1 width=112)
 (actual time=0.020..0.020 rows=0 loops=1)
   Index Cond: ((pubid)::text = ' books/acm/Kim95'::text)
 Planning time: 0.210 ms
 Execution time: 0.048 ms
\end{verbatim}
}


\paragraph{Multipoint Query -- Low Selectivity}

Repeat the following query multiple times with different conditions for {\tt booktitle}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE booktitle = ...
\end{verbatim}
}

\noindent
Which conditions did you use?
We created a file of 4841 booktitles, which we got from the actual data. These are all distinct booktitles.\\
This file was then read into Java and executed as Prepared Statements.

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: 21.6s => 0.0045s/q\\
Throughput: 224q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
query plan
\end{verbatim}
}


\paragraph{Multipoint Query -- High Selectivity}

Repeat the following query multiple times with different conditions for {\tt year}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE year = ...
\end{verbatim}
}

\noindent
Which conditions did you use?

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: \\
Throughput: 

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
query plan
\end{verbatim}
}


\section{Table Scan}

\noindent \emph{Note:} Make sure the data is not physically ordered by
the indexed attributes due to the clustering index that you created
before.

\paragraph{Point Query}

Repeat the following query multiple times with different conditions for {\tt pubID}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE pubID = ...
\end{verbatim}
}

\noindent
Which conditions did you use?\\
We created a file of 500 pubIDs, which we got from the actual data.\\
This file was then read into Java and executed as Prepared Statements.\\
Further queries used the same setup, using booktitles and years.

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: 125.9s => 0.251 s/q\\
Throughput: 4 q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
 Seq Scan on publ  (cost=0.00..37841.18 rows=1 width=112)
 (actual time=359.876..359.876 rows=0 loops=1)
   Filter: ((pubid)::text = ' books/acm/Kim95'::text)
   Rows Removed by Filter: 1233214
 Planning time: 0.108 ms
 Execution time: 359.903 ms
\end{verbatim}
}


\paragraph{Multipoint Query -- Low Selectivity}

Repeat the following query multiple times with different conditions for {\tt booktitle}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE booktitle = ...
\end{verbatim}
}

\noindent
Which conditions did you use?
We created a file of 4841 booktitles (300 used), which we got from the actual data. These are all distinct booktitles.\\
This file was then read into Java and executed as Prepared Statements.

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: 84.3s => 0.281s/q\\
Throughput: 3.56q/s

\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
 Seq Scan on publ  (cost=0.00..37843.18 rows=179 width=112)
 (actual time=172.752..276.457 rows=97 loops=1)
   Filter: ((booktitle)::text = 'Z User Workshop'::text)
   Rows Removed by Filter: 1233117
 Planning time: 0.143 ms
 Execution time: 276.524 ms
\end{verbatim}
}


\paragraph{Multipoint Query -- High Selectivity}

Repeat the following query multiple times with different conditions for {\tt year}.

{\small
\begin{verbatim}
SELECT * FROM Publ WHERE year = ...
\end{verbatim}
}

\noindent
Which conditions did you use?

\smallskip\noindent
Show the runtime results and compute the throughput.\\
Runtime: \\
Throughput: 


\smallskip\noindent
Query plan (for one of the queries):
{\small
\begin{verbatim}
query plan
\end{verbatim}
}

\section{Discussion}

Give the throughput of the query types and index types in queries/second.
\begin{center}
  \begin{tabular}{c|c|c|c|c}
    & clustered & non-clust.\ B$^+$-tree & non-clust.\ hash & table scan \\
    \hline
    point ({\tt pubID}) & & & \\
    \hline
    multipoint ({\tt booktitle}) & & & \\
    \hline
    multipoint  ({\tt year}) & & & \\  
  \end{tabular}
\end{center}

\medskip

Discuss the runtime results for the different index types and the
table scan. Are the results expected? Why / why not?


\bigskip

\noindent Time in hours per person: {\bf XXX}

\bigskip

\begin{center}
  \begin{tabular}{c}
    \hline
    {\bf Important:} Reference your information sources!
    \\\hline
  \end{tabular}
\end{center}

\end{document}
\grid
