\documentclass[11pt]{scrartcl}

\usepackage{url,float}

\title{
  \textbf{\large Database Tuning -- Assignment 2}\\
  Query Tuning
}

\author{
 Group Name A3\\
 \large Platzer Hugo, 1421579 \\
 \large Strohmeier Mario, 1422959
}

\begin{document}

\maketitle

\subsection*{Experimental Data}

\paragraph{Creating Tables and Indexes}

SQL statements used to create the tables {\tt Employee}, {\tt
  Student}, and {\tt Techdept}, and the indexes on the tables:

{\small
\begin{verbatim}
  CREATE TABLE employee
  (
    ssnum integer,
    name character varying,
    manager character varying,
    dept character varying,
    salary integer,
    numfriends integer,
    CONSTRAINT employee_name_key UNIQUE (name),
    CONSTRAINT employee_ssnum_key UNIQUE (ssnum)
  )

  CREATE INDEX dept_index ON employee (dept)

  CREATE TABLE student
  (
    ssnum integer,
    name character varying,
    course character varying,
    grade integer,
    CONSTRAINT student_name_key UNIQUE (name),
    CONSTRAINT student_ssnum_key UNIQUE (ssnum)
  )

  CREATE TABLE techdept
  (
    dept character varying,
    manager character varying,
    location character varying,
    CONSTRAINT techdept_dept_key UNIQUE (dept)
  )
\end{verbatim}
}

\paragraph{Populating the Tables}

ssnum: Ascending int values from the inserting for-loop\\
name: Random 20 character string with characters a-z, to minimize errors from duplicates\\
manager: Random letter from A-Z, to have a good chance of duplicates\\
dept: Random letter from A-J, to have a good chance of duplicates\\
salary: Random integer between 1-100000\\
numfriends: Random integer between 1-100\\
course: Random 5 character string with character a-z\\
grade: Random integer between 1-5\\
location: Random 3 character string with character a-z\\


\subsection*{Query 1}

\paragraph{Intention}

This query should count the number of employees for which the total
number of employees in their department exceeds 1000.

\paragraph{Original Query}

{\small
\begin{verbatim}
SELECT COUNT(*) FROM Employee e1 WHERE
    (SELECT COUNT(*) FROM Employee e2 WHERE e2.dept = e1.dept) > 1000;
\end{verbatim}
}

\paragraph{Rewritten Query}

{\small
\begin{verbatim}
SELECT dept, COUNT(dept) AS cnt INTO Temp FROM Employee GROUP BY dept;
SELECT COUNT(*) FROM Employee, Temp WHERE
    Employee.dept = Temp.dept AND Temp.cnt > 1000;
\end{verbatim}
}

\paragraph{Evaluation of the Execution Plans}

Execution plan original query:

\begin{verbatim}
  execution plan original query...
\end{verbatim}

Give an interpretation of the execution plan, i.e., describe how the
original query is evaluated.

Execution plan rewritten query:

\begin{verbatim}
  execution plan rewritten query...
\end{verbatim}

Give an interpretation of the execution plan, i.e., describe how the
rewritten query is evaluated.

Discuss, how the execution plan changed between the original and the
rewritten query. In both the interpretation of the query plans and the
discussion focus on the crucial parts, i.e., the parts of the query
plans that cause major runtime differences.

\paragraph{Runtime} Discuss, why the rewritten query is (or is not)
faster than the original query.


\begin{table}[H]
  \begin{tabular}{l|r}
    & Runtime [sec] \\
   \hline
    Original query & \\
    Rewritten query & \\
  \end{tabular}
\end{table}

\subsection*{Query 2}

\paragraph{Original Query}

{\small
\begin{verbatim}
  SQL ORIGINAL QUERY
\end{verbatim}
}

\paragraph{Rewritten Query}

{\small
\begin{verbatim}
  SQL REWRITTEN QUERY
\end{verbatim}
}

\paragraph{Evaluation of the Execution Plans}

Execution plan original query:

\begin{verbatim}
  execution plan original query...
\end{verbatim}

Give an interpretation of the execution plan, i.e., describe how the
original query is evaluated.

Execution plan rewritten query:

\begin{verbatim}
  execution plan rewritten query...
\end{verbatim}

Give an interpretation of the execution plan, i.e., describe how the
rewritten query is evaluated.

Discuss, how the execution plan changed between the original and the
rewritten query. In both the interpretation of the query plans and the
discussion focus on the crucial parts, i.e., the parts of the query
plans that cause major runtime differences.

\paragraph{Runtime} Discuss, why the rewritten query is (or is not)
faster than the original query.


\begin{table}[H]
  \begin{tabular}{l|r}
    & Runtime [sec] \\
   \hline
    Original query & \\
    Rewritten query & \\
  \end{tabular}
\end{table}


  Time in hours per person: {\bf XXX}

\end{document}
